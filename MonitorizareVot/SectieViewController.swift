//  Created by Code4Romania

import UIKit
import CoreData

enum SectieErrorType {
    case judetNotSet
    case judetInvalid
    case sectieNotSet
    case sectieInvalid
}

class SectieViewController: RootViewController {

    // MARK: - iVars
    private var sectionInfo = MVSectionInfo()
    private var tapGestureRecognizer: UITapGestureRecognizer?
    @IBOutlet private weak var terytTextField: UITextField!
    @IBOutlet private weak var bottomTextField: UITextField!
    @IBOutlet private weak var bottomConstraint: NSLayoutConstraint!
    private let formsVersionsFetcher = FormsFetcher(formsPersistor: LocalFormsPersistor())
    private let syncer = DBSyncer()
    
    // MARK: - Life cycle
    override func viewDidLoad() {
        super.viewDidLoad()
        self.navigationController?.navigationBar.isHidden = false
        self.navigationItem.hidesBackButton = true
        formsVersionsFetcher.fetch {[weak self] (tokenExpired) in
            if tokenExpired {
                let _ = self?.navigationController?.popToRootViewController(animated: false)
            }
        }

        syncer.syncUnsyncedData()
        setTapGestureRecognizer()
    }
    
    override func viewWillAppear(_ animated: Bool) {
        super.viewWillAppear(animated)
        checkLocalStorage()
        NotificationCenter.default.addObserver(self, selector: #selector(SectieViewController.keyboardDidShow), name: NSNotification.Name.UIKeyboardWillShow, object: nil)
        NotificationCenter.default.addObserver(self, selector: #selector(SectieViewController.keyboardDidHide), name: NSNotification.Name.UIKeyboardWillHide, object: nil)
    }
    
    override func viewWillDisappear(_ animated: Bool) {
        super.viewWillDisappear(animated)
        NotificationCenter.default.removeObserver(self)
    }
    
    @IBAction func bottomButtonPressed(_ sender: UIButton) {
        print("bottomButtonPressed");
        if ((sectionInfo.judet == nil) || (sectionInfo.judet == "")) {
            showAlertController(errorType: .judetNotSet)
        } else if sectionInfo.sectie == nil {
            showAlertController(errorType: .sectieNotSet)
        } else {
            
            let validTeryt: [String] = ["321801", "321802", "321803", "321804", "321805", "321701", "321702", "321703", "321704", "321705", "321601", "321602", "321603", "321604", "321605", "321606", "321501", "321502", "321503", "321504", "321505", "321506", "321401", "321402", "321403", "321404", "321405", "321406", "321408", "321409", "321410", "321411", "321301", "321302", "321303", "321304", "321305", "321306", "221601", "221602", "221603", "221604", "221605", "201401", "201402", "201403", "201404", "201405", "201301", "201302", "201303", "201304", "201305", "201306", "201307", "201308", "201309", "201310", "21001", "21002", "21003", "21004", "21005", "21006", "21007", "20901", "20902", "20903", "20904", "20905", "20906", "20907", "20908", "22501", "22502", "22503", "22504", "22505", "22506", "22507", "22301", "22302", "22303", "22304", "22305", "22306", "22307", "22308", "22309", "22401", "22402", "22403", "22404", "22405", "22406", "22407", "22101", "22102", "22103", "22104", "22105", "22106", "22107", "22108", "22201", "22202", "22203", "146502", "146503", "146504", "146505", "146506", "146507", "146508", "146509", "146510", "146511", "146512", "146513", "146514", "146515", "146516", "146517", "146518", "146519", "143801", "143802", "143803", "143804", "143805", "22601", "22602", "22603", "22604", "22605", "22606", "143701", "143702", "143703", "143704", "143705", "143706", "143501", "143502", "143503", "143504", "143505", "143506", "143601", "143602", "143603", "143604", "143605", "143401", "143402", "143403", "143404", "143405", "143406", "143407", "143408", "143409", "143301", "143302", "143303", "143304", "143305", "143306", "143307", "143308", "143309", "143001", "143002", "143003", "143004", "143005", "143201", "143202", "143203", "143204", "143205", "143206", "143207", "143410", "143411", "143412", "142901", "142902", "142903", "142904", "142905", "142906", "142907", "142908", "142909", "142801", "142802", "142803", "142804", "142805", "142806", "142807", "142808", "142701", "142702", "142703", "142704", "142705", "142706", "142707", "142601", "142602", "142603", "142604", "142605", "142606", "142607", "142608", "142609", "142610", "142611", "142612", "142613", "142501", "142502", "142503", "142504", "142505", "142506", "142507", "142508", "142509", "142510", "142511", "142512", "142513", "142401", "142402", "142403", "142404", "142405", "142406", "142407", "142301", "142302", "142303", "142304", "142305", "142306", "142307", "142308", "142201", "142202", "142203", "142204", "142205", "142206", "142207", "22001", "22002", "22003", "22004", "22005", "22006", "21901", "21902", "21903", "21904", "21905", "21906", "21907", "21908", "21801", "21802", "21803", "21804", "21805", "21701", "21702", "21703", "21704", "21705", "21401", "21402", "21403", "21404", "21405", "21406", "21407", "21408", "21301", "21302", "21303", "21201", "21202", "21203", "21204", "21205", "21101", "21102", "21103", "21104", "21601", "21602", "21603", "21604", "21605", "21606", "21501", "21502", "21503", "21504", "121901", "121902", "121903", "121904", "121905", "121801", "121802", "121803", "121804", "121805", "121806", "121807", "121808", "121809", "121810", "121501", "121502", "121503", "121504", "121505", "121506", "121507", "121508", "121509", "121401", "121402", "121403", "121404", "121405", "121406", "121601", "121602", "121603", "121604", "121605", "121606", "121607", "121608", "121609", "121610", "121611", "121612", "121613", "121614", "121615", "121616", "121701", "121702", "121703", "121704", "121705", "121301", "121302", "121303", "121304", "121305", "121306", "121307", "121308", "121309", "121201", "121203", "121204", "121205", "121206", "121207", "121101", "121102", "121103", "121104", "121105", "121106", "121107", "121108", "121109", "121110", "121111", "121112", "121113", "121114", "121001", "121002", "121003", "121004", "121005", "121006", "121007", "121008", "121009", "121010", "121011", "121012", "121013", "121014", "121015", "121016", "120901", "120902", "120903", "120904", "120905", "120906", "120907", "120908", "120909", "141901", "141902", "141903", "141904", "141905", "141906", "141907", "141908", "141909", "141910", "141911", "141912", "141913", "141914", "141915", "142101", "142102", "142103", "142104", "142105", "142106", "142001", "142002", "142003", "142004", "142005", "142006", "142007", "142008", "142009", "142010", "142011", "142012", "141801", "141802", "141803", "141804", "141805", "141806", "141701", "141702", "141703", "141704", "141705", "141706", "141707", "141708", "141601", "141602", "141603", "141604", "141605", "141606", "141607", "141608", "141609", "141610", "141611", "141501", "141502", "141503", "141504", "141505", "141506", "141507", "141508", "141509", "141510", "141511", "141401", "141402", "141403", "141404", "141405", "141406", "141301", "141302", "141303", "141304", "141305", "141306", "141307", "141308", "141201", "141204", "141205", "141206", "141207", "141208", "141101", "141102", "141103", "141104", "141105", "141106", "141107", "141001", "141002", "141003", "141004", "141005", "141006", "140901", "140902", "140903", "140904", "140905", "140906", "141309", "141310", "140801", "140802", "140803", "140804", "140805", "141209", "141210", "141211", "141212", "141213", "141214", "141215", "141108", "141109", "141110", "62001", "62002", "62003", "62004", "62005", "62006", "62007", "62008", "62009", "62010", "62011", "62012", "62013", "62014", "62015", "61901", "61902", "61903", "61904", "61905", "61906", "61907", "61908", "61801", "61802", "61803", "61804", "61805", "61806", "61807", "61808", "61809", "61810", "61811", "61812", "61701", "61702", "61703", "61704", "61705", "61813", "61601", "61602", "61603", "61604", "61605", "61606", "61501", "61502", "61503", "61504", "61505", "61506", "61401", "61402", "61403", "61404", "61405", "61406", "61407", "61301", "61302", "61303", "61304", "61305", "61306", "61307", "61507", "61508", "61408", "61409", "61410", "61411", "61201", "61202", "61203", "61204", "61205", "61206", "61207", "20801", "20802", "20803", "20804", "20701", "20702", "20703", "20704", "20601", "20602", "20603", "20604", "20605", "20606", "20501", "20502", "20503", "20504", "20401", "20402", "20403", "20404", "20805", "20806", "20807", "20808", "20809", "20810", "20811", "20607", "20608", "20609", "20301", "20302", "20303", "20304", "20305", "20306", "20201", "20202", "20203", "20204", "20205", "20206", "20101", "20102", "20103", "20104", "20105", "20106", "20505", "20506", "120801", "120802", "120803", "120804", "120805", "120806", "120807", "120701", "120702", "120703", "120704", "120705", "120706", "120707", "120708", "20812", "20813", "20814", "120601", "120602", "120603", "120604", "120605", "120606", "120607", "120608", "20207", "120501", "120502", "120503", "120504", "120505", "120506", "120507", "120508", "120509", "120401", "120402", "120403", "120404", "120405", "120406", "120407", "120709", "120710", "120711", "120712", "120609", "120610", "120611", "120612", "120613", "120614", "120615", "120616", "120617", "120510", "120301", "120302", "120303", "120304", "120305", "120201", "120202", "120203", "120204", "120205", "120206", "120101", "120102", "120103", "120104", "120105", "120106", "120107", "120207", "120108", "120109", "41901", "41902", "41903", "41904", "41905", "41906", "41801", "41802", "41803", "41804", "41805", "41806", "41807", "41701", "41702", "41703", "41704", "41705", "41601", "41602", "41603", "41604", "41605", "41606", "41808", "41809", "41810", "41811", "41812", "41813", "41501", "41502", "41503", "41504", "41505", "41506", "41507", "41401", "41402", "41403", "41404", "41405", "41301", "41302", "41303", "41304", "41201", "41202", "41203", "41204", "41205", "41206", "41508", "41509", "41406", "41407", "41408", "41409", "41410", "41411", "41101", "41102", "41103", "41104", "41105", "41106", "140701", "140702", "140703", "140704", "140705", "140706", "140707", "41001", "41002", "41003", "41004", "41005", "140601", "140602", "140603", "140604", "140605", "140606", "41107", "140607", "140608", "140609", "140611", "140501", "140502", "140503", "140504", "140505", "140506", "140301", "140302", "140303", "140304", "140305", "140306", "140307", "140308", "140309", "140310", "140311", "140401", "140402", "140403", "140404", "140405", "140312", "140313", "140314", "61101", "61102", "61103", "61104", "61105", "61106", "61107", "61108", "61109", "61110", "61111", "61001", "61002", "61003", "61004", "61005", "61006", "140201", "140202", "140203", "140204", "140205", "140206", "140207", "140208", "140209", "140101", "140102", "140103", "140104", "140105", "140106", "60901", "60902", "60903", "60904", "60905", "60906", "60907", "60908", "60909", "60910", "60911", "60912", "60913", "60914", "60915", "60801", "60802", "60803", "60804", "60805", "60806", "60807", "60808", "60809", "60810", "60811", "60812", "60813", "60701", "60702", "60703", "60704", "60705", "60706", "60707", "60708", "60709", "60710", "60601", "60602", "60603", "60604", "60605", "60606", "60607", "60609", "60610", "60916", "60611", "60501", "60502", "60503", "60504", "60505", "60506", "60507", "60401", "60402", "60403", "60404", "60405", "60406", "60407", "60408", "60301", "60302", "60303", "60304", "60305", "60306", "60307", "60308", "60309", "60310", "60311", "60312", "60313", "60314", "60315", "60201", "60202", "60203", "60204", "60205", "60206", "60207", "60208", "60209", "60210", "60211", "60212", "60213", "60214", "60101", "60102", "60103", "60104", "60105", "60106", "60107", "60108", "60109", "60110", "60111", "60112", "60113", "60114", "60115", "60116", "60117", "60118", "60119", "81101", "81102", "81103", "81104", "81105", "81106", "81107", "81108", "81109", "81110", "81001", "81002", "81003", "81004", "81005", "81006", "81007", "81008", "81009", "80901", "80902", "80903", "80904", "80905", "80906", "80907", "80908", "80909", "80801", "80802", "80803", "80804", "80805", "80806", "81201", "81202", "81203", "80701", "80702", "80703", "80704", "80705", "102101", "102102", "102103", "102104", "102105", "102001", "102002", "102003", "102004", "102005", "102006", "102007", "101901", "101902", "101903", "101904", "101801", "101802", "101803", "101804", "101701", "101702", "101703", "101704", "101705", "101706", "101707", "101708", "101709", "101710", "101601", "101602", "101603", "101604", "101605", "101606", "101607", "101608", "101609", "101610", "101611", "102008", "102009", "101501", "101502", "101503", "101504", "101505", "101506", "101507", "101508", "101509", "101805", "101806", "101807", "101401", "101402", "101403", "101404", "101405", "101406", "101407", "101408", "101301", "101302", "101303", "101304", "101305", "101306", "201201", "201202", "201203", "201204", "201205", "201206", "201207", "201101", "201102", "201103", "201104", "201105", "201106", "201107", "201108", "201109", "40901", "40902", "40903", "40904", "101409", "101410", "101411", "201208", "201209", "201110", "40801", "40802", "40803", "40804", "40805", "40806", "40807", "40808", "40701", "40702", "40703", "40704", "40705", "40706", "40707", "40601", "40602", "40603", "40604", "40605", "40606", "40809", "40708", "40709", "40101", "40102", "40103", "40104", "40105", "40106", "40107", "40108", "40401", "40402", "40403", "40404", "40405", "40406", "40407", "40201", "40202", "40203", "40204", "40205", "40301", "40302", "40303", "40304", "40305", "40306", "40307", "40308", "40501", "40502", "40503", "40504", "40505", "40506", "40109", "40206", "40207", "40208", "40209", "40210", "281901", "281902", "281903", "281801", "281802", "281803", "281701", "281702", "281703", "281704", "281705", "281706", "281501", "281502", "281503", "281504", "281505", "281506", "281507", "281508", "281601", "281602", "281603", "281604", "281101", "281102", "281103", "281104", "281001", "281002", "281003", "281004", "281005", "281401", "281402", "281403", "281404", "281405", "281406", "281407", "281408", "281303", "281304", "281305", "281306", "281201", "281202", "281203", "281204", "281205", "281707", "281708", "281509", "80601", "80602", "80603", "80604", "80605", "281409", "281410", "281411", "281412", "80501", "80502", "80503", "80504", "80505", "80401", "80402", "80403", "80404", "80405", "80406", "80407", "80301", "80302", "80303", "80304", "80305", "80306", "80201", "80202", "80203", "80204", "80205", "80206", "80207", "80408", "80101", "80102", "80103", "80104", "80105", "80106", "80107", "101201", "101202", "101203", "101204", "101205", "101206", "101207", "101208", "101209", "101210", "101211", "101212", "101213", "101214", "101101", "101102", "101103", "101104", "101105", "101106", "101001", "101002", "101003", "101004", "101005", "101006", "101007", "101008", "101009", "101010", "101011", "100901", "100902", "100903", "100904", "100905", "100906", "100907", "100908", "100801", "100802", "100803", "100804", "100805", "100806", "100807", "100701", "100702", "100703", "100704", "100705", "100706", "100707", "100708", "100602", "100603", "100607", "100608", "100610", "100611", "100501", "100502", "100503", "100504", "100505", "100506", "100401", "100402", "100403", "100404", "100405", "100507", "100508", "100509", "100510", "100301", "100302", "100303", "100304", "100305", "100406", "100407", "100408", "100101", "100102", "100103", "100104", "100105", "100106", "100107", "100108", "100201", "100202", "100203", "100204", "100205", "100206", "100207", "100208", "100209", "100210", "100211", "201001", "201002", "201003", "201004", "201005", "201006", "201007", "201008", "201009", "200901", "200902", "200903", "200904", "200905", "200701", "200702", "200703", "200704", "200705", "200706", "200707", "200708", "200709", "200801", "200802", "200803", "200804", "200805", "200806", "200807", "200601", "200602", "200603", "200604", "200605", "200606", "200501", "200502", "200503", "200504", "200505", "200506", "200507", "200508", "200509", "200401", "200402", "200403", "200404", "200405", "200406", "200101", "200102", "200103", "200104", "200105", "200106", "200107", "200201", "200202", "200203", "200204", "200205", "200206", "200207", "200208", "200209", "200210", "200211", "200212", "200213", "200214", "200215", "200301", "200302", "200303", "200304", "200305", "200306", "200307", "200308", "261301", "261302", "261303", "261304", "261305", "261306", "261201", "261202", "261203", "261204", "261205", "261206", "261207", "261208", "261101", "261102", "261103", "261104", "261105", "261001", "261002", "261003", "261004", "261005", "260901", "260902", "260903", "260904", "260905", "260906", "260907", "260908", "260909", "260801", "260802", "260803", "260804", "260805", "260601", "260602", "260603", "260604", "260605", "260606", "260607", "260608", "260701", "260702", "260703", "260704", "260705", "260706", "260501", "260502", "260503", "260504", "260505", "260506", "260507", "260508", "260401", "260402", "260403", "260404", "260405", "260406", "260407", "260408", "260409", "260410", "260411", "260412", "260413", "260414", "260415", "260416", "260417", "260418", "260419", "260301", "260302", "260303", "260304", "260305", "260201", "260202", "260203", "260204", "260205", "260206", "260101", "260102", "260103", "260104", "260105", "260106", "260107", "260108", "280901", "280902", "280903", "280904", "280905", "280801", "280802", "280803", "280804", "280805", "280806", "280701", "280702", "280703", "280704", "280705", "280706", "280707", "260207", "260208", "260209", "280601", "280604", "280605", "280606", "280608", "280610", "280501", "280502", "280503", "280504", "280505", "280101", "280102", "280103", "280104", "280105", "280106", "280401", "280402", "280403", "280404", "280405", "280406", "280407", "280408", "280409", "280301", "280302", "280303", "280304", "280305", "280306", "280201", "280202", "280203", "280204", "280205", "280206", "280207", "181901", "181902", "181903", "181904", "181905", "182001", "182002", "182003", "182004", "182101", "181801", "181802", "181803", "181804", "181805", "181806", "182102", "182103", "182104", "182105", "181501", "181502", "181503", "181601", "181602", "181603", "181604", "181605", "181701", "181702", "181703", "181704", "181705", "181401", "181402", "181403", "181404", "181405", "181406", "181504", "181505", "181606", "181607", "181608", "181609", "181610", "181611", "181706", "181707", "181708", "181407", "181408", "181409", "181301", "181302", "181303", "181304", "181305", "181306", "181307", "181201", "181202", "181203", "181204", "181205", "181612", "181613", "181614", "181308", "181309", "181310", "241701", "241702", "241703", "241704", "241705", "241706", "241707", "241708", "241709", "241710", "241601", "241602", "241603", "241604", "241605", "241606", "241607", "241608", "241609", "241610", "241501", "241502", "241503", "241504", "241505", "241506", "241507", "241508", "241509", "181206", "181207", "241401", "241402", "241403", "241404", "241405", "241301", "241302", "241303", "241304", "241305", "241306", "241307", "241308", "241309", "241711", "241712", "241713", "241714", "241715", "241201", "241202", "241203", "241204", "241205", "241101", "241102", "241103", "241104", "241105", "241106", "241107", "241108", "240901", "240902", "240903", "240904", "240905", "241001", "241002", "241003", "241004", "241005", "241006", "221501", "221502", "221503", "221504", "221505", "221506", "221507", "221508", "221509", "221510", "221401", "221402", "221403", "221404", "221405", "221406", "221301", "221302", "221303", "221304", "221305", "221306", "221307", "221308", "221309", "221310", "221311", "221312", "221313", "221001", "221002", "221003", "221004", "221005", "221101", "221102", "221103", "221104", "221105", "221106", "221107", "221201", "221202", "221203", "221204", "221205", "221206", "221207", "221208", "221209", "221210", "181001", "181002", "181003", "181004", "181005", "181006", "181007", "181101", "181102", "181103", "181104", "181105", "181106", "181107", "181108", "181109", "181110", "180801", "180802", "180803", "180804", "180805", "180901", "180902", "180903", "180904", "180905", "180906", "180907", "180908", "180701", "180702", "180703", "180704", "180705", "180706", "180707", "180708", "180709", "180710", "180601", "180602", "180603", "180604", "180605", "180606", "180501", "180502", "180503", "180504", "180505", "180506", "180507", "180508", "180509", "180511", "180401", "180402", "180403", "180404", "180405", "180406", "180407", "180408", "180409", "180410", "180411", "180301", "180302", "180303", "180304", "180305", "180306", "180307", "180201", "180202", "180203", "180204", "180205", "180206", "180103", "180105", "180108", "240801", "240802", "240803", "240804", "240805", "240701", "240702", "240703", "240704", "240705", "240706", "240707", "240708", "240601", "240602", "240603", "240604", "240605", "240606", "240501", "240502", "240503", "240504", "240505", "240506", "240401", "240402", "240403", "240404", "240405", "240607", "240608", "240609", "240507", "240508", "240406", "240407", "240408", "240409", "240410", "240411", "240412", "240413", "240414", "240415", "240416", "220901", "220903", "220904", "220906", "220907", "220908", "240201", "240202", "240203", "240204", "240205", "240206", "240207", "240208", "240209", "240210", "240301", "240302", "240303", "240304", "240305", "240306", "240307", "240308", "240309", "240310", "240101", "240102", "240103", "240104", "240105", "240106", "240311", "240312", "240107", "240108", "220801", "220802", "220803", "220804", "220805", "220701", "220702", "220703", "220704", "220705", "220706", "220601", "220602", "220603", "220604", "220605", "220606", "220607", "220608", "220501", "220502", "220503", "220504", "220505", "220506", "220507", "220508", "220401", "220402", "220403", "220404", "220405", "220406", "220407", "220408", "161001", "161002", "161003", "161004", "220301", "220302", "220303", "220304", "220305", "220306", "220307", "220201", "220202", "220203", "220204", "220205", "220101", "220102", "220103", "220104", "220105", "220106", "220107", "220108", "220109", "220110", "161101", "161102", "161103", "161104", "161105", "161106", "161107", "160901", "160902", "160903", "160904", "160905", "160906", "160907", "160908", "160909", "160910", "160911", "160912", "160801", "160802", "160803", "160804", "160805", "160806", "160807", "160701", "160702", "160703", "160704", "160705", "160706", "160707", "160708", "160709", "160913", "160601", "160602", "160603", "160604", "160605", "160501", "160502", "160503", "160504", "160505", "160401", "160402", "160403", "160404", "160301", "160302", "160303", "160304", "160305", "160306", "160201", "160202", "160203", "160204", "160101", "160102", "160103", "160104", "160105", "160106", "303101", "303102", "303103", "303104", "303105", "303106", "303107", "303108", "303001", "303002", "303003", "303004", "303005", "302901", "302902", "302903", "302801", "302802", "302803", "302804", "302805", "302806", "302807", "302701", "302702", "302703", "302704", "302705", "302706", "302707", "302708", "302709", "302601", "302602", "302603", "302604", "302401", "302402", "302403", "302404", "302405", "302406", "302407", "302408", "302501", "302502", "302503", "302504", "302505", "302301", "302302", "302303", "302304", "302305", "302306", "302307", "302308", "302201", "302202", "302203", "302204", "302205", "302101", "302102", "302103", "302104", "302105", "302106", "302107", "302108", "302109", "302110", "302111", "302112", "302113", "302114", "302115", "302116", "302117", "302001", "302002", "302003", "302004", "302005", "302006", "301801", "301802", "301803", "301804", "301805", "301806", "301807", "301901", "301902", "301903", "301904", "301905", "301906", "301907", "301908", "301909", "301601", "301602", "301603", "301701", "301702", "301703", "301704", "301705", "301706", "301707", "301708", "301501", "301502", "301503", "301504", "301505", "301506", "301401", "301402", "301403", "301404", "301301", "301302", "301303", "301304", "301305", "301306", "301307", "301201", "301202", "301203", "301204", "301205", "301206", "300901", "300902", "300903", "300904", "300905", "300906", "300907", "300908", "300909", "300910", "300911", "301001", "301002", "301003", "301004", "301005", "301006", "301007", "301008", "301009", "301010", "301011", "301101", "301102", "301103", "301104", "301105", "300801", "300802", "300803", "300804", "300805", "300806", "300807", "301012", "301013", "301014", "300701", "300702", "300703", "300704", "300705", "300706", "300707", "300708", "300709", "300710", "300711", "300601", "300602", "300603", "300604", "300501", "300502", "300503", "300504", "300505", "300401", "300402", "300403", "300404", "300405", "300406", "300407", "300301", "300302", "300303", "300304", "300305", "300306", "300307", "300308", "300309", "300310", "300201", "300202", "300203", "300204", "300205", "300206", "300207", "300208", "300101", "300102", "300103", "300104", "300105", "320901", "320902", "320903", "320904", "320905", "320906", "320907", "320908", "321101", "321102", "321103", "321104", "321201", "321202", "321203", "321204", "321205", "321206", "321001", "321002", "321003", "321004", "321005", "320701", "320702", "320703", "320704", "320801", "320802", "320803", "320804", "320805", "320601", "320602", "320603", "320604", "320605", "320501", "320502", "320503", "320504", "320507", "320402", "320403", "320404", "320405", "320406", "320301", "320302", "320303", "320305", "320306", "320201", "320202", "320203", "320204", "320205", "320206", "320705", "320706", "320806", "320807", "320606", "320607", "320608", "320609", "320101", "320102", "320103", "320104", "320508", "320407", "146100", "146200", "146300", "146400"]
            
            print(sectionInfo.judet!);
            
            if (validTeryt.contains(sectionInfo.judet!)) {
                UserDefaults.standard.set(sectionInfo.judet!, forKey: "judet")
                UserDefaults.standard.set(sectionInfo.sectie!, forKey: "sectie")
                showNextScreen()
            } else {
                showAlertController(errorType: .judetInvalid)
            }
            
            
        }
    }
    
    @IBAction func textFieldDidEndEditing(_ sender: UITextField) {
        if let text = sender.text {
            sectionInfo.sectie = text
        }
    }
    
    @IBAction func TerytDidEndEditing(_ sender: UITextField) {
        if let text = sender.text {
            sectionInfo.judet = text
        }
    }
    

    // MARK: - Utils
    func keyboardDidShow(notification: Notification) {
        if let userInfo = notification.userInfo, let frame = userInfo[UIKeyboardFrameBeginUserInfoKey] as? CGRect {
            bottomConstraint.constant = frame.size.height
            performKeyboardAnimation()
        }
    }
    
    func keyboardDidHide(notification: Notification) {
        keyboardIsHidden()
    }
    
    func keyboardIsHidden() {
        bottomConstraint?.constant = 0
        performKeyboardAnimation()
        view.endEditing(true)
    }
    
    private func showAlertController(errorType: SectieErrorType) {
        let alertButton = UIAlertAction(title: "OK", style: .cancel, handler: nil)
        
        switch errorType {
        case .judetNotSet:
            let alertController = UIAlertController(title: "Podaj kod TERYT gminy", message: "", preferredStyle: .alert)
            alertController.addAction(alertButton)
            self.present(alertController, animated: true, completion: nil)
        case .sectieNotSet:
            let alertController = UIAlertController(title: "Podaj numer lokalu wyborczego", message: "", preferredStyle: .alert)
            alertController.addAction(alertButton)
            self.present(alertController, animated: true, completion: nil)
        case .sectieInvalid:
            let alertController = UIAlertController(title: "Numer lokalu wyborczego jest nieprawidłowy", message: "", preferredStyle: .alert)
            alertController.addAction(alertButton)
            self.present(alertController, animated: true, completion: nil)
        case .judetInvalid:
            let alertController = UIAlertController(title: "Poday kod TERYT jest nieprawidłowy", message: "", preferredStyle: .alert)
            alertController.addAction(alertButton)
            self.present(alertController, animated: true, completion: nil)
        }
    }
    
    private func showNextScreen() {
        if let sectieInfosViewController = UIStoryboard(name: "Main", bundle: nil).instantiateViewController(withIdentifier: "SectionInformationsViewController") as? SectionInformationsViewController {
            sectieInfosViewController.sectionInfo = sectionInfo
            self.navigationController?.pushViewController(sectieInfosViewController, animated: true)
        }
    }
    
    private func setTapGestureRecognizer() {
        let tapGestureRecognizer = UITapGestureRecognizer(target: self, action: #selector(SectieViewController.keyboardIsHidden))
        self.tapGestureRecognizer = tapGestureRecognizer
        self.view.addGestureRecognizer(tapGestureRecognizer)
    }
    
    private func checkLocalStorage() {
        if let judet = UserDefaults.standard.string(forKey: "judet") {
            sectionInfo.judet = judet
            terytTextField.text = judet
        }
        
        if let sectie = UserDefaults.standard.string(forKey: "sectie") {
            sectionInfo.sectie = sectie
            bottomTextField.text = sectie
        }
    }
    
    // MARK: - UITextFieldDelegate
    func textFieldShouldReturn(_ textField: UITextField) -> Bool {
        textField.resignFirstResponder()
        return true
    }
    
}
